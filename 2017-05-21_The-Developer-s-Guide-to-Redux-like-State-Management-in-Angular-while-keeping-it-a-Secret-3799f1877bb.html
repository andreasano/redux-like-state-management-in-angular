<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>The Developer&#39;s Guide to Redux-like State Management in Angular while keeping it a Secret</title><meta name="description" content="While keeping it a secret"><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">The Developer&#39;s Guide to Redux-like State Management in Angular while keeping it a Secret</h1>
</header>
<section data-field="subtitle" class="p-summary">
While keeping it a secret
</section>
<section data-field="body" class="e-content">
<section name="b59d" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="b72b" id="b72b" class="graf graf--h3 graf--leading graf--title">The Developer&#39;s Guide to Redux-like State Management in Angular while keeping it a Secret</h3><h4 name="1dee" id="1dee" class="graf graf--h4 graf-after--h3 graf--subtitle">While keeping it a secret</h4><figure name="1358" id="1358" class="graf graf--figure graf-after--h4"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 452px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 64.60000000000001%;"></div><img class="graf-image" data-image-id="1*NY5UxO187nMzYgfm2lfYyw.jpeg" data-width="1920" data-height="1241" data-is-featured="true" src="https://cdn-images-1.medium.com/max/1600/1*NY5UxO187nMzYgfm2lfYyw.jpeg"></div><figcaption class="imageCaption">The road to Single State Management</figcaption></figure><p name="4f6a" id="4f6a" class="graf graf--p graf-after--figure">More and more people are talking about JavaScript state management systems like Redux, MobX or Relay. Almost every article, tutorial or talk out there has something to do with the libraries above.</p><p name="773a" id="773a" class="graf graf--p graf-after--p">Let’s say you join an ongoing Angular project and you say:</p><blockquote name="d52e" id="d52e" class="graf graf--blockquote graf-after--p">Yes, I want it, I want to get inspired by Redux!</blockquote><p name="f90f" id="f90f" class="graf graf--p graf-after--blockquote">You google around and find the <a href="https://github.com/ngrx/store" data-href="https://github.com/ngrx/store" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">@ngrx/store</a> library which is great and you cannot wait to use it. Then you talk to the team about <strong class="markup--strong markup--p-strong">not</strong> managing state in controllers, introducing concepts like <strong class="markup--strong markup--p-strong">actions</strong>, <strong class="markup--strong markup--p-strong">reducers</strong>, <strong class="markup--strong markup--p-strong">selectors,</strong> and <strong class="markup--strong markup--p-strong">immutability</strong>.</p><p name="be5b" id="be5b" class="graf graf--p graf-after--p">Depending on your team’s momentum, the decision to adopt new technologies can take a while.</p><h3 name="e460" id="e460" class="graf graf--h3 graf-after--p">In the meantime, welcome RxJS!</h3><p name="053a" id="053a" class="graf graf--p graf-after--h3">You already have RxJS reactive extensions bundled up in your Angular application. Embracing their power will allow you to use the principles of Redux without having the need to introduce specific terminologies like actions and reducers.</p><p name="d551" id="d551" class="graf graf--p graf-after--p">Redux can be described in three fundamental principles:</p><blockquote name="5496" id="5496" class="graf graf--blockquote graf-after--p">Single source of truth</blockquote><blockquote name="4efa" id="4efa" class="graf graf--blockquote graf-after--blockquote">State is read-only</blockquote><blockquote name="3325" id="3325" class="graf graf--blockquote graf-after--blockquote">Changes are made with pure functions</blockquote><p name="c836" id="c836" class="graf graf--p graf-after--blockquote">To illustrate all of this, let&#39;s build a small app which <strong class="markup--strong markup--p-strong">retrieves</strong>, <strong class="markup--strong markup--p-strong">lists</strong> and <strong class="markup--strong markup--p-strong">counts</strong> my <a href="https://github.com/intojs" data-href="https://github.com/intojs" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Github repos</a>, sticking to the Redux principles while using RxJS.</p><p name="36e7" id="36e7" class="graf graf--p graf-after--p">The state of our application will be stored in an object tree within a single store.</p><h3 name="f5ce" id="f5ce" class="graf graf--h3 graf-after--p">Modeling our data</h3><p name="7e3d" id="7e3d" class="graf graf--p graf-after--h3">Our application&#39;s state has a <strong class="markup--strong markup--p-strong">repos</strong> entity which can be in an <strong class="markup--strong markup--p-strong">isLoading </strong>state and can have many objects of type <strong class="markup--strong markup--p-strong">Repo</strong> loaded from Github.<br>Sometimes errors happen which means that our <strong class="markup--strong markup--p-strong">repos</strong> entity needs a <strong class="markup--strong markup--p-strong">hasError</strong> property.</p><p name="5554" id="5554" class="graf graf--p graf-after--p"><em class="markup--em markup--p-em">There is no need for a </em><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">count</em></strong><em class="markup--em markup--p-em"> property because we can derive its value from the length of the repos array.</em></p><figure name="397a" id="397a" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/intojs/6aa911ee28b705661e47cf39a2f2223d.js.js"></script></figure><figure name="3278" id="3278" class="graf graf--figure graf--iframe graf-after--figure"><script src="https://gist.github.com/intojs/b0abddadd4fd0bbff6bf55b2429232f6.js"></script></figure><h3 name="3957" id="3957" class="graf graf--h3 graf-after--figure">Creating a store service</h3><p name="cf3d" id="cf3d" class="graf graf--p graf-after--h3">Having finished modeling our data, let’s create a store service which will hold the applications’ state in a RxJS <strong class="markup--strong markup--p-strong">BehaviorSubject</strong>.</p><figure name="4739" id="4739" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/intojs/93cb979278f947020b5068db1d034668.js"></script></figure><p name="d0aa" id="d0aa" class="graf graf--p graf-after--figure">The store service exposes an <strong class="markup--strong markup--p-strong">observe</strong> method which, together with the <strong class="markup--strong markup--p-strong">distinctUntilChanged</strong> operator returns an observable sequence that contains only distinct contiguous elements empowering the immutable character of our state.</p><p name="c7ae" id="c7ae" class="graf graf--p graf-after--p">The second method is called <strong class="markup--strong markup--p-strong">dispatch </strong>and is in charge of updating our state by calling <strong class="markup--strong markup--p-strong">next</strong>. The method expects an event of <strong class="markup--strong markup--p-strong">StoreEvent</strong>. It passes the current state to that event and gets back a fresh new one.</p><p name="a828" id="a828" class="graf graf--p graf-after--p">The store service will be a provider of the store module, being injectable app-wide.</p><h3 name="a1db" id="a1db" class="graf graf--h3 graf-after--p">Creating events</h3><p name="1b88" id="1b88" class="graf graf--p graf-after--h3">Now that the store is complete, we need events to update it. Each event has a <strong class="markup--strong markup--p-strong">payload </strong>and a <strong class="markup--strong markup--p-strong">getNewState</strong> method which holds the reducer logic.</p><p name="553c" id="553c" class="graf graf--p graf-after--p">The <strong class="markup--strong markup--p-strong">StoreEvent</strong> abstract class ensures that our future events will have consistency and is, in fact, a nice way of implementing the concepts of <strong class="markup--strong markup--p-strong">actions</strong> and <strong class="markup--strong markup--p-strong">reducers</strong> without anybody noticing it.</p><figure name="f747" id="f747" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/intojs/13e3535cfafb5618733811c03f7d658f.js"></script></figure><p name="54f6" id="54f6" class="graf graf--p graf-after--figure">Thinking about the process of getting repos from Github, our application will handle three events: <strong class="markup--strong markup--p-strong">GetRepos</strong>, <strong class="markup--strong markup--p-strong">GetReposSuccess</strong>, <strong class="markup--strong markup--p-strong">GetReposError</strong>.</p><h4 name="cd50" id="cd50" class="graf graf--h4 graf-after--p">Getting repos</h4><p name="b548" id="b548" class="graf graf--p graf-after--h4">The event has no payload, it just needs to set the state&#39;s <strong class="markup--strong markup--p-strong">isLoading</strong> property to true and return a new copy of it without mutations.</p><h4 name="1f49" id="1f49" class="graf graf--h4 graf-after--p">Repos have been fetched successfully</h4><p name="5012" id="5012" class="graf graf--p graf-after--h4">This event receives the <strong class="markup--strong markup--p-strong">repos</strong> as a <strong class="markup--strong markup--p-strong">payload</strong> and it stores them in our state together with setting the <strong class="markup--strong markup--p-strong">isLoading</strong> and <strong class="markup--strong markup--p-strong">hasError</strong> properties to <strong class="markup--strong markup--p-strong">false</strong>.</p><h4 name="6965" id="6965" class="graf graf--h4 graf-after--p">Could not retrieve repos</h4><p name="7a57" id="7a57" class="graf graf--p graf-after--h4">I know Github always works, but, let&#39;s build the error event nonetheless.</p><figure name="4227" id="4227" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/intojs/7990668f318cf34b667a9ca776d719fd.js"></script></figure><h3 name="b23e" id="b23e" class="graf graf--h3 graf-after--figure">Creating the repos service</h3><p name="cb21" id="cb21" class="graf graf--p graf-after--h3">At this point, we have set up our infrastructure, having our single source of truth neatly stored away into a <strong class="markup--strong markup--p-strong">BehavoirSubject</strong> and our events ready to be emitted!</p><p name="39c2" id="39c2" class="graf graf--p graf-after--p">In order to interact with Github and fetch our data, we need a service.<br>Because our state is decoupled from our components, we can delegate event dispatching to this very service, making it communicate with our store.</p><figure name="d137" id="d137" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/intojs/854baed56ab9045503630a2a3ef6964e.js"></script></figure><h3 name="5932" id="5932" class="graf graf--h3 graf-after--figure">Consuming the state</h3><p name="c1b8" id="c1b8" class="graf graf--p graf-after--h3">Now that we have created the service, let&#39;s consume our state and hook everything up at the component level.</p><p name="b116" id="b116" class="graf graf--p graf-after--p">We will inject our store and subscribe to the repos properties.</p><p name="e385" id="e385" class="graf graf--p graf-after--p">The <strong class="markup--strong markup--p-strong">async pipe</strong> is really handy, making it possible to use the subscription directly at the template level.<br><br>The interesting part consists in using RxJs operators to query our store, just like a front end database.</p><p name="def4" id="def4" class="graf graf--p graf-after--p"><em class="markup--em markup--p-em">Notice how we derive the </em><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">total count</em></strong><em class="markup--em markup--p-em"> of the repos without having this information directly in our datastore.</em></p><figure name="4172" id="4172" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/intojs/b1ce2cb620406b6c5af37eae1dfa53f9.js"></script></figure><p name="ee5d" id="ee5d" class="graf graf--p graf-after--figure">With this said, I hope this article was useful and I can hardly wait to see your comments.</p><p name="7d2b" id="7d2b" class="graf graf--p graf-after--p graf--trailing">You can <a href="https://github.com/intojs/redux-like-state-management-in-angular" data-href="https://github.com/intojs/redux-like-state-management-in-angular" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">clone the repo</a> this article was based on from Github. It uses Angular-cli so it should be a snap to demo out.</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@danieldughila" class="p-author h-card">Daniel Dughila</a> on <a href="https://medium.com/p/3799f1877bb"><time class="dt-published" datetime="2017-05-21T14:31:44.016Z">May 21, 2017</time></a>.</p><p>Exported from <a href="https://medium.com">Medium</a> on May 22, 2017.</p></footer></article>

</body></html>